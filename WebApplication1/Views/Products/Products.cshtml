@model WebApplication1.Models.ProductListViewModel

@{
    ViewData["Title"] = "Продукты";
}

<h1>Список продуктов</h1>

<!-- Отладочная информация -->
<div class="alert alert-info">
    Всего продуктов: @Model.TotalCount<br />
    Страница: @Model.CurrentPage из @Model.TotalPages<br />
    Продуктов на странице: @(Model.Products?.Count ?? 0)
</div>

<!-- Фильтрация и сортировка -->
<form method="get" class="mb-3">
    <div class="row">
        <div class="col-md-3">
            <select name="categoryId" class="form-control"
                    asp-items="ViewBag.Categories">
                <option value="">Все категории</option>
            </select>
        </div>
        <div class="col-md-3">
            <select name="sortBy" class="form-control">
                <option value="name" selected="@(Model.SortBy == "name")">По названию</option>
                <option value="price" selected="@(Model.SortBy == "price")">По цене</option>
            </select>
        </div>
        <div class="col-md-3">
            <select name="sortOrder" class="form-control">
                <option value="asc" selected="@(Model.SortOrder == "asc")">По возрастанию</option>
                <option value="desc" selected="@(Model.SortOrder == "desc")">По убыванию</option>
            </select>
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary">Применить</button>
        </div>
    </div>
</form>

<!-- Таблица товаров -->
@if (Model.Products != null && Model.Products.Any())
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Цена</th>
                <th>Категория</th>
                <th>Изображений</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model.Products)
            {
                <tr>
                    <td>@product.Id</td>
                    <td>@product.Name</td>
                    <td>@product.Price.ToString("C")</td>
                    <td>@(product.Category?.Name ?? "Без категории")</td>
                    <td>@(product.Images?.Count ?? 0)</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="alert alert-warning">
        <h4>Продукты не найдены!</h4>
        <p>В базе данных нет продуктов, соответствующих критериям поиска.</p>
        <p>Проверьте фильтры или убедитесь, что данные были добавлены.</p>
    </div>
}

<!-- Пагинация -->
@if (Model.TotalPages > 1)
{
    <nav>
        <ul class="pagination">
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                    <a class="page-link"
                       href="?page=@i&categoryId=@Model.CategoryId&sortBy=@Model.SortBy&sortOrder=@Model.SortOrder">
                        @i
                    </a>
                </li>
            }
        </ul>
    </nav>
}